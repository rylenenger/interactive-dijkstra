<!DOCTYPE html>
<html lang="en">

<head>
    <title>Interactive Dijkstra Tool</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/konva@8.3.5/konva.min.js"></script>
</head>

<body>

    <div class="container">
        <div class="jumbotron">
            <h1>Interactive Dijkstra Project</h1>
            <p>Simple, interactive tool for problems requiring the dijkstra algorithm.</p>
        </div>
        <div class="row">
            <div class="text-center col-sm-12">
                <h3>The App</h3>
                <div id="stage-parent">
                    <div id="container"></div>
                    <div id="menu">
                        <div>
                            <button id="setStart-button">Set Start</button>
                            <button id="delete-button">Delete</button>
                        </div>
                    </div>
                </div>

                <script>
                    var sceneWidth = 1200;
                    var sceneHeight = sceneWidth / 2;

                    var stage = new Konva.Stage({
                        container: 'container',
                        width: sceneWidth,
                        height: sceneHeight,
                    });

                    var layer = new Konva.Layer();
                    stage.add(layer);

                    stage.on('dblclick dbltap', function () {
                        // add a new shape
                        var node = new Konva.Circle({
                            x: stage.getRelativePointerPosition().x,
                            y: stage.getRelativePointerPosition().y,
                            radius: 30,
                            fill: Konva.Util.getRandomColor(),
                            stroke: 'black',
                            strokeWidth: 2,
                            draggable: true,
                        });

                        
                        node.on('dragmove', () => {
                            const circle = node.getClientRect();
                            const absPos = node.getAbsolutePosition();
                            const offsetX = circle.x - absPos.x;
                            const offsetY = circle.y - absPos.y;

                            const newAbsPos = { ...absPos }
                            if (circle.x < 0) {
                                newAbsPos.x = -offsetX;
                            }
                            if (circle.y < 0) {
                                newAbsPos.y = -offsetY;
                            }
                            if (circle.x + circle.width > stage.width()) {
                                newAbsPos.x = stage.width() - circle.width - offsetX;
                            }
                            if (circle.y + circle.height > stage.height()) {
                                newAbsPos.y = stage.height() - circle.height - offsetY;
                            }
                            node.setAbsolutePosition(newAbsPos)
                        });
                        

                        layer.add(node);
                    });

                    // setup menu
                    let currentShape;
                    var menuNode = document.getElementById('menu');
                    document.getElementById('setStart-button').addEventListener('click', () => {
                        currentShape.to({
                            scaleX: 2,
                            scaleY: 2,
                            onFinish: () => {
                                currentShape.to({ scaleX: 1, scaleY: 1 });
                            },
                        });
                    });

                    document.getElementById('delete-button').addEventListener('click', () => {
                        currentShape.destroy();
                    });

                    window.addEventListener('click', () => {
                        // hide menu
                        menuNode.style.display = 'none';
                    });



                    stage.on('contextmenu', function (e) {
                        // prevent default behavior
                        e.evt.preventDefault();
                        if (e.target === stage) {
                            // if we are on empty place of the stage we will do nothing
                            return;
                        }
                        currentShape = e.target;
                        // show menu
                        menuNode.style.display = 'initial';
                        var containerRect = stage.container().getBoundingClientRect();
                        menuNode.style.top = stage.getPointerPosition().y + 60 + 'px';
                        menuNode.style.left = stage.getPointerPosition().x + 40 + 'px';
                    });



                    function fitStageIntoParentContainer() {
                        var container = document.querySelector('#stage-parent');

                        // now we need to fit stage into parent container
                        var containerWidth = container.offsetWidth;

                        // but we also make the full scene visible
                        // so we need to scale all objects on canvas
                        var scale = containerWidth / sceneWidth;

                        stage.width(sceneWidth * scale);
                        stage.height(sceneHeight * scale);
                        stage.scale({ x: scale, y: scale });
                    }

                    fitStageIntoParentContainer();
                    // adapt the stage on any window resize
                    window.addEventListener('resize', fitStageIntoParentContainer);
                </script>

            </div>
        </div>
        <div class="row">
            <div class="col-sm-4">
                <h3>Column 1</h3>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
                <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
            </div>
            <div class="col-sm-4">
                <h3>Column 2</h3>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
                <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
            </div>
            <div class="col-sm-4">
                <h3>Column 3</h3>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
                <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
            </div>
        </div>
    </div>

</body>

</html>